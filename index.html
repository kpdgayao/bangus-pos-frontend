<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üêü Bangus Bowl Co.</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      min-height: 100vh;
      padding: 10px;
      color: #333;
    }
    
    /* MAIN CONTAINER - ADAPTIVE */
    .container {
      max-width: 100%; /* Mobile Default */
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      position: relative;
    }

    /* SMALL PHONE ADJUSTMENTS */
    @media (max-width: 374px) {
      .container {
        padding: 15px;
        border-radius: 12px;
      }

      .header h1 {
        font-size: 22px;
      }

      body {
        padding: 8px;
      }
    }

    /* PHONE/PHABLET (375px - 767px) - Keep single column */
    @media (min-width: 375px) {
      .container {
        max-width: 450px;
        padding: 25px;
      }

      .header h1 {
        font-size: 26px;
      }
    }

    /* TABLET PORTRAIT (768px - 899px) - Single column, wider container */
    @media (min-width: 768px) {
      body {
        padding: 20px;
      }

      .container {
        max-width: 720px;
        padding: 30px;
        border-radius: 18px;
      }

      .header h1 {
        font-size: 28px;
      }

      /* Keep single column layout for portrait tablets */
      .app-layout {
        display: block;
      }
    }

    /* LARGE TABLET/LANDSCAPE (900px - 1023px) - Enable grid layout */
    @media (min-width: 900px) {
      .container {
        max-width: 850px;
        padding: 35px;
      }

      /* The Grid Wrapper */
      .app-layout {
        display: grid;
        grid-template-columns: 1.2fr 0.8fr; /* Menu takes 60%, Cart takes 40% */
        gap: 30px;
        align-items: start;
      }

      /* Sticky Cart on Tablet */
      .col-right {
        position: sticky;
        top: 20px;
        background: #fdfdfd;
        padding: 20px;
        border-radius: 15px;
        border: 1px solid #eee;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      }

      .header {
        grid-column: 1 / -1; /* Header spans full width */
        margin-bottom: 35px;
      }

      .header h1 {
        font-size: 30px;
      }
    }

    /* DESKTOP (1024px+) - Maximum width and spacing */
    @media (min-width: 1024px) {
      body {
        padding: 30px;
      }

      .container {
        max-width: 1000px;
        padding: 40px;
        border-radius: 20px;
      }

      .app-layout {
        gap: 40px;
      }

      .header {
        margin-bottom: 40px;
      }

      .header h1 {
        font-size: 32px;
      }
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .header h1 {
      font-size: 24px;
      color: #1e3c72;
      margin-bottom: 5px;
    }
    
    .header p {
      color: #999;
      font-size: 14px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #555;
      font-size: 14px;
    }
    
    /* INPUTS */
    select, input[type="number"], input[type="text"] {
      width: 100%;
      padding: 14px; /* Slightly larger touch target */
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px; /* Better for tablet reading */
      margin-bottom: 20px;
      transition: all 0.3s;
      background: white;
    }
    
    select:focus, input:focus {
      outline: none;
      border-color: #2a5298;
      box-shadow: 0 0 0 3px rgba(42,82,152,0.1);
    }
    
    /* BUTTONS */
    .add-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
      font-size: 16px;
      margin-bottom: 20px;
      transition: transform 0.2s;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .add-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(30,60,114,0.3);
    }
    
    /* CART STYLES */
    .cart-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 20px;
    }
    
    /* On large tablet/desktop, the cart section inside the right col doesn't need gray bg */
    @media (min-width: 900px) {
      .cart-section {
        background: transparent;
        padding: 0;
      }
    }

    .cart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e0e0e0;
    }
    
    .cart-title {
      font-size: 18px;
      font-weight: 700;
      color: #333;
    }
    
    .cart-count {
      background: #2a5298;
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 700;
    }
    
    .cart-empty {
      text-align: center;
      color: #999;
      padding: 30px 20px;
      font-size: 14px;
      border: 2px dashed #e0e0e0;
      border-radius: 10px;
    }
    
    .cart-item {
      background: white;
      padding: 12px;
      border-radius: 10px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      border: 1px solid #f0f0f0;
    }
    
    .cart-item-info {
      flex: 1;
    }
    
    .cart-item-name {
      font-weight: 600;
      color: #333;
      margin-bottom: 4px;
      font-size: 14px;
    }
    
    .cart-item-details {
      font-size: 12px;
      color: #666;
    }
    
    .cart-item-actions {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .qty-btn {
      background: #2a5298;
      color: white;
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }
    
    .qty-btn:hover {
      background: #1e3c72;
    }
    
    .remove-btn {
      background: #dc3545;
      color: white;
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }
    
    .remove-btn:hover {
      background: #c82333;
    }
    
    .total-section {
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      padding: 20px;
      border-radius: 15px;
      color: white;
      text-align: center;
      margin-top: 15px;
      box-shadow: 0 5px 15px rgba(30,60,114,0.2);
    }
    
    .total-label {
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 5px;
    }
    
    .total-amount {
      font-size: 32px;
      font-weight: 700;
    }
    
    .checkout-section {
      margin-top: 20px;
    }
    
    .submit-btn {
      width: 100%;
      padding: 18px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
      font-size: 18px;
      transition: all 0.2s;
      box-shadow: 0 4px 6px rgba(40,167,69,0.2);
    }
    
    .submit-btn:hover:not(:disabled) {
      background: #218838;
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(40,167,69,0.3);
    }
    
    .submit-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      box-shadow: none;
    }

    /* SPINNER (Fixed for Tablet centering) */
    .loading {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255,255,255,0.9);
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      z-index: 2000;
      text-align: center;
    }
    
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #2a5298;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .result {
      display: none;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      margin-top: 20px;
      font-size: 14px;
    }
    
    .result.success {
      display: block;
      background: #d4edda;
      color: #155724;
      border: 2px solid #c3e6cb;
    }
    
    .result.error {
      display: block;
      background: #f8d7da;
      color: #721c24;
      border: 2px solid #f5c6cb;
    }
    
    /* MODALS */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      overflow-y: auto;
      padding: 15px;
    }
    
    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .modal-content {
      background: white;
      border-radius: 15px;
      padding: 20px;
      max-width: 95%;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    /* Modal responsive sizing */
    @media (min-width: 480px) {
      .modal-content {
        max-width: 450px;
        padding: 25px;
      }
    }

    @media (min-width: 768px) {
      .modal {
        padding: 20px;
      }

      .modal-content {
        max-width: 500px;
        padding: 30px;
        border-radius: 20px;
      }
    }

    @media (min-width: 1024px) {
      .modal-content {
        max-width: 550px;
      }
    }
    
    .modal-header {
      text-align: center;
      margin-bottom: 25px;
    }
    
    .modal-header h2 {
      font-size: 24px;
      color: #333;
      margin-bottom: 5px;
    }
    
    .modal-header .order-number {
      font-size: 16px;
      color: #2a5298;
      font-weight: 600;
    }
    
    .confirm-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 20px;
    }
    
    .confirm-items {
      margin-bottom: 15px;
    }
    
    .confirm-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .confirm-item:last-child {
      border-bottom: none;
    }
    
    .confirm-total {
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      color: white;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      font-size: 24px;
      font-weight: 700;
      margin-top: 15px;
    }
    
    .confirm-info {
      margin-top: 20px;
      font-size: 14px;
      color: #666;
      line-height: 1.8;
    }
    
    .confirm-info strong {
      color: #333;
    }
    
    .modal-buttons {
      display: flex;
      gap: 10px;
      margin-top: 25px;
    }
    
    .modal-btn {
      flex: 1;
      padding: 14px;
      border: none;
      border-radius: 10px;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-cancel {
      background: #6c757d;
      color: white;
    }
    
    .btn-cancel:hover {
      background: #5a6268;
    }
    
    .btn-confirm {
      background: #28a745;
      color: white;
    }
    
    .btn-confirm:hover:not(:disabled) {
      background: #218838;
    }
    
    .btn-confirm:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .payment-fields {
      display: none;
    }

    .payment-fields.active {
      display: block;
    }

    .change-display {
      display: none;
      background: #e7f3ff;
      border: 2px solid #2a5298;
      padding: 15px;
      border-radius: 10px;
      margin-top: 10px;
      text-align: center;
    }

    .change-display.active {
      display: block;
    }

    .change-label {
      font-size: 13px;
      color: #666;
      margin-bottom: 5px;
    }

    .change-amount {
      font-size: 24px;
      font-weight: 700;
      color: #2a5298;
    }

    /* DRAWER UI */
    .recent-orders-drawer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      box-shadow: 0 -5px 20px rgba(0,0,0,0.2);
      transform: translateY(100%);
      transition: transform 0.3s ease;
      z-index: 999;
      max-height: 70vh;
      overflow-y: auto;
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
    }
    
    /* Make drawer responsive across devices */
    @media (min-width: 768px) and (max-width: 899px) {
      .recent-orders-drawer {
        left: auto;
        right: 20px;
        width: 350px; /* Narrower for tablet portrait */
        border-radius: 20px 20px 0 0;
      }
    }

    @media (min-width: 900px) and (max-width: 1023px) {
      .recent-orders-drawer {
        left: auto;
        right: 20px;
        width: 400px; /* Medium width for large tablets */
        border-radius: 20px 20px 0 0;
      }
    }

    @media (min-width: 1024px) {
      .recent-orders-drawer {
        left: auto;
        right: 20px;
        width: 450px; /* Wider for desktop */
        border-radius: 20px 20px 0 0;
      }
    }
    
    .recent-orders-drawer.open {
      transform: translateY(0);
    }
    
    .drawer-toggle-btn {
      width: 100%;
      padding: 14px;
      background: #2a5298;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
      margin-top: 15px;
      font-size: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .drawer-toggle-btn:hover {
      background: #1e3c72;
    }
    
    .drawer-content {
      padding: 20px;
      max-width: 100%;
      margin: 0 auto;
    }
    
    .drawer-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e0e0e0;
    }
    
    .drawer-title {
      font-size: 18px;
      font-weight: 700;
      color: #333;
    }
    
    .drawer-close {
      background: #dc3545;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
    }

    .recent-orders-empty {
      text-align: center;
      color: #999;
      padding: 30px 20px;
      font-size: 14px;
    }

    .recent-order-item {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 10px;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s, opacity 0.3s;
      user-select: none;
    }

    .recent-order-item.swiping {
      transition: transform 0.1s;
    }

    .recent-order-item.removing {
      opacity: 0;
      transform: translateX(-100%);
    }

    .recent-order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .recent-order-number {
      font-weight: 700;
      color: #2a5298;
      font-size: 15px;
    }

    .recent-order-total {
      font-weight: 700;
      color: #333;
      font-size: 16px;
    }

    .recent-order-details {
      font-size: 12px;
      color: #666;
    }

    .swipe-indicator {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #ccc;
      font-size: 12px;
      pointer-events: none;
    }

    /* VISUAL FEEDBACK ANIMATIONS */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    @keyframes slideInRight {
      from {
        transform: translateX(20px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes successPop {
      0% { transform: scale(0.8); opacity: 0; }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }

    .shake {
      animation: shake 0.5s ease-in-out;
    }

    .pulse {
      animation: pulse 0.3s ease-in-out;
    }

    .slide-in {
      animation: slideInRight 0.3s ease-out;
    }

    .success-pop {
      animation: successPop 0.4s ease-out;
    }

    /* QUICK QUANTITY BUTTONS */
    .qty-quick-buttons {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .qty-quick-btn {
      flex: 1;
      min-width: 60px;
      padding: 10px;
      background: #f0f0f0;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      color: #555;
      transition: all 0.2s;
    }

    .qty-quick-btn:hover {
      background: #e8e8e8;
      border-color: #2a5298;
      color: #2a5298;
      transform: translateY(-1px);
    }

    .qty-quick-btn.active {
      background: #2a5298;
      color: white;
      border-color: #2a5298;
    }

    /* CLEAR CART BUTTON */
    .clear-cart-btn {
      width: 100%;
      padding: 12px;
      background: #6c757d;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      margin-top: 10px;
      transition: all 0.2s;
    }

    .clear-cart-btn:hover {
      background: #5a6268;
      transform: translateY(-1px);
    }

    /* REORDER BUTTON IN DRAWER */
    .reorder-btn {
      background: #28a745;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 11px;
      font-weight: 600;
      margin-top: 8px;
      transition: all 0.2s;
      width: 100%;
    }

    .reorder-btn:hover {
      background: #218838;
      transform: translateY(-1px);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üêü Bangus Bowl Co.</h1>
      <p>Order System</p>
    </div>

    <div class="app-layout">
      
      <div class="col-left">
        <label for="item">Select Item</label>
        <select id="item">
          <option value="">-- Choose an item --</option>
          <optgroup label="BANGUS RICE BOWLS">
            <option value="Bangus Shanghai Bowl (6 pcs)">Bangus Shanghai Bowl (6 pcs) - ‚Ç±115</option>
            <option value="Bangus Sisig Bowl (without egg)">Bangus Sisig Bowl (without egg) - ‚Ç±150</option>
          </optgroup>
          <optgroup label="SNACK">
            <option value="Bangus Shanghai Bites (6 pcs, no rice)">Bangus Shanghai Bites (6 pcs, no rice) - ‚Ç±90</option>
            <option value="Bangus Shanghai Dozen (12 pcs, no rice)">Bangus Shanghai Dozen (12 pcs, no rice) - ‚Ç±170</option>
          </optgroup>
          <optgroup label="ADD-ONS">
            <option value="Extra Egg">Extra Egg - ‚Ç±20</option>
            <option value="Extra Shanghai (3 pcs)">Extra Shanghai (3 pcs) - ‚Ç±45</option>
            <option value="Extra Rice">Extra Rice - ‚Ç±25</option>
            <option value="Water">Water - ‚Ç±20</option>
          </optgroup>
          <optgroup label="MIX BOWLS">
            <option value="Breakfast Combo">Breakfast Combo - ‚Ç±130</option>
            <option value="Lechon Kawali Bowl">Lechon Kawali Bowl - ‚Ç±130</option>
            <option value="Frozen Bangus Shanghai Pack">Frozen Bangus Shanghai Pack - ‚Ç±250</option>
          </optgroup>
        </select>

        <label for="qty">Quantity</label>
        <input type="number" id="qty" value="1" min="1">

        <div class="qty-quick-buttons">
          <button class="qty-quick-btn active" onclick="setQuantity(1)">√ó1</button>
          <button class="qty-quick-btn" onclick="setQuantity(2)">√ó2</button>
          <button class="qty-quick-btn" onclick="setQuantity(3)">√ó3</button>
          <button class="qty-quick-btn" onclick="setQuantity(5)">√ó5</button>
        </div>

        <button class="add-btn" id="addToCartBtn" onclick="addToCart()">‚ûï Add to Cart</button>
      </div>

      <div class="col-right">
        <div class="cart-section">
          <div class="cart-header">
            <span class="cart-title">üõí Cart</span>
            <span class="cart-count" id="cartCount">0</span>
          </div>
          <div id="cartItems">
            <div class="cart-empty">Cart is empty. Add items.</div>
          </div>
          <button class="clear-cart-btn" id="clearCartBtn" onclick="clearCart()" style="display: none;">üóëÔ∏è Clear All Items</button>
          <div class="total-section">
            <div class="total-label">Total Amount</div>
            <div class="total-amount">‚Ç±<span id="totalAmount">0</span></div>
          </div>
        </div>

        <div class="checkout-section">
          <label for="customer">Customer Name (Optional)</label>
          <input type="text" id="customer" placeholder="e.g., Juan Dela Cruz">

          <label for="payment">Payment Method</label>
          <select id="payment" onchange="togglePaymentFields()">
            <option value="Cash">Cash</option>
            <option value="GCash">GCash</option>
          </select>

          <div id="cashFields" class="payment-fields active">
            <label for="amountTendered">Amount Tendered</label>
            <input type="number" id="amountTendered" placeholder="Enter amount" step="0.01" oninput="calculateChange()">
            
            <div id="changeDisplay" class="change-display">
              <div class="change-label">Change</div>
              <div class="change-amount">‚Ç±<span id="changeAmount">0.00</span></div>
            </div>
          </div>

          <div id="gcashFields" class="payment-fields">
            <label for="referenceNumber">GCash Reference Number</label>
            <input type="text" id="referenceNumber" placeholder="Enter reference number">
          </div>

          <button class="submit-btn" id="submitBtn" onclick="showConfirmation()" disabled>
            üßæ Submit Order
          </button>

          <button class="drawer-toggle-btn" onclick="toggleDrawer()">
            üìã View Recent Orders
          </button>
        </div>
        
        <div id="result" class="result"></div>
      </div>
    </div>
  </div>

  <div class="loading" id="loading">
    <div class="spinner"></div>
    <div style="margin-top: 10px; color: #2a5298; font-weight: 600;">Processing...</div>
  </div>

  <div class="recent-orders-drawer" id="recentOrdersDrawer">
    <div class="drawer-content">
      <div class="drawer-header">
        <div class="drawer-title">üìã Recent Orders</div>
        <button class="drawer-close" onclick="toggleDrawer()">Close</button>
      </div>
      <div id="recentOrdersContainer">
        <div class="recent-orders-empty">No orders yet</div>
      </div>
    </div>
  </div>

  <div id="confirmModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Confirm Order</h2>
        <div class="order-number">Order #<span id="previewOrderNumber">Pending...</span></div>
      </div>

      <div class="confirm-section">
        <div class="confirm-items" id="confirmItems"></div>
        <div class="confirm-total">Total: ‚Ç±<span id="confirmTotal">0</span></div>
      </div>

      <div class="confirm-info">
        <div><strong>Customer:</strong> <span id="confirmCustomer"></span></div>
        <div><strong>Payment:</strong> <span id="confirmPayment"></span></div>
        <div id="confirmPaymentDetails"></div>
      </div>

      <div class="modal-buttons">
        <button class="modal-btn btn-cancel" onclick="closeConfirmation()">Cancel</button>
        <button class="modal-btn btn-confirm" id="confirmBtn" onclick="submitOrder()">Confirm Order</button>
      </div>
    </div>
  </div>

  <script>
    const WEBHOOK_URL = 'https://n8n-production-211f.up.railway.app/webhook/bangus-order';

    // AUDIO FEEDBACK
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(frequency, duration, type = 'sine') {
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();

      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);

      oscillator.frequency.value = frequency;
      oscillator.type = type;

      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + duration);
    }

    function playAddToCartSound() {
      playSound(800, 0.1);
    }

    function playSuccessSound() {
      playSound(600, 0.1);
      setTimeout(() => playSound(800, 0.15), 100);
    }

    function playErrorSound() {
      playSound(200, 0.2);
    }

    const menuPrices = {
      'Bangus Shanghai Bowl (6 pcs)': 115,
      'Bangus Sisig Bowl (without egg)': 150,
      'Bangus Shanghai Bites (6 pcs, no rice)': 90,
      'Bangus Shanghai Dozen (12 pcs, no rice)': 170,
      'Extra Egg': 20,
      'Extra Shanghai (3 pcs)': 45,
      'Extra Rice': 25,
      'Breakfast Combo': 130,
      'Lechon Kawali Bowl': 130,
      'Frozen Bangus Shanghai Pack': 250,
      'Water': 20
    };
    
    let cart = [];

    // QUICK QUANTITY BUTTONS
    function setQuantity(qty) {
      const qtyInput = document.getElementById('qty');
      qtyInput.value = qty;

      // Update button styles
      document.querySelectorAll('.qty-quick-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
    }

    // CLEAR CART FUNCTION
    function clearCart() {
      if (cart.length === 0) return;

      if (confirm('Clear all items from cart?')) {
        cart = [];
        updateCart();
        playSound(400, 0.1);
      }
    }

    // KEYBOARD SHORTCUTS
    document.addEventListener('keydown', function(e) {
      // Escape key - close modals/drawer
      if (e.key === 'Escape') {
        const modal = document.getElementById('confirmModal');
        const drawer = document.getElementById('recentOrdersDrawer');

        if (modal.classList.contains('active')) {
          closeConfirmation();
        } else if (drawer.classList.contains('open')) {
          toggleDrawer();
        }
      }

      // Enter key on item dropdown - add to cart
      if (e.key === 'Enter' && document.activeElement.id === 'item') {
        e.preventDefault();
        addToCart();
      }

      // Ctrl/Cmd + K - focus item dropdown
      if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        document.getElementById('item').focus();
      }
    });

    function toggleDrawer() {
      const drawer = document.getElementById('recentOrdersDrawer');
      drawer.classList.toggle('open');
    }

    function togglePaymentFields() {
      const payment = document.getElementById('payment').value;
      const cashFields = document.getElementById('cashFields');
      const gcashFields = document.getElementById('gcashFields');
      
      if (payment === 'Cash') {
        cashFields.classList.add('active');
        gcashFields.classList.remove('active');
        document.getElementById('referenceNumber').value = '';
      } else {
        cashFields.classList.remove('active');
        gcashFields.classList.add('active');
        document.getElementById('amountTendered').value = '';
        document.getElementById('changeDisplay').classList.remove('active');
      }
    }

    function calculateChange() {
      const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      const tendered = parseFloat(document.getElementById('amountTendered').value) || 0;
      const changeDisplay = document.getElementById('changeDisplay');
      const changeAmount = document.getElementById('changeAmount');
      
      if (tendered >= total && total > 0) {
        const change = tendered - total;
        changeAmount.textContent = change.toFixed(2);
        changeDisplay.classList.add('active');
      } else {
        changeDisplay.classList.remove('active');
      }
    }

    // SWIPE LOGIC
    let touchStartX = 0;
    let touchEndX = 0;
    let currentSwipeElement = null;

    function handleSwipeStart(e, element) {
      touchStartX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
      currentSwipeElement = element;
      element.classList.add('swiping');
    }

    function handleSwipeMove(e, element) {
      if (!currentSwipeElement) return;
      
      touchEndX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
      const diff = touchEndX - touchStartX;
      
      if (diff < 0) {
        element.style.transform = `translateX(${diff}px)`;
      }
    }

    function handleSwipeEnd(e, element, orderNumber) {
      if (!currentSwipeElement) return;
      
      const diff = touchEndX - touchStartX;
      const threshold = -100; 
      
      element.classList.remove('swiping');
      
      if (diff < threshold) {
        deleteOrder(orderNumber, element);
      } else {
        element.style.transform = 'translateX(0)';
      }
      
      currentSwipeElement = null;
      touchStartX = 0;
      touchEndX = 0;
    }

    function deleteOrder(orderNumber, element) {
      element.classList.add('removing');
      
      setTimeout(() => {
        const orders = JSON.parse(localStorage.getItem('recentOrders') || '[]');
        const updatedOrders = orders.filter(order => order.orderNumber !== orderNumber);
        localStorage.setItem('recentOrders', JSON.stringify(updatedOrders));
        loadRecentOrders();
      }, 300);
    }

    function loadRecentOrders() {
      const container = document.getElementById('recentOrdersContainer');
      const orders = JSON.parse(localStorage.getItem('recentOrders') || '[]');

      if (orders.length === 0) {
        container.innerHTML = '<div class="recent-orders-empty">No orders yet</div>';
        return;
      }

      const recentOrders = orders.slice(-20).reverse();

      container.innerHTML = recentOrders.map(order => `
        <div class="recent-order-item"
             data-order-number="${order.orderNumber}"
             ontouchstart="handleSwipeStart(event, this)"
             ontouchmove="handleSwipeMove(event, this)"
             ontouchend="handleSwipeEnd(event, this, '${order.orderNumber}')"
             onmousedown="handleSwipeStart(event, this)"
             onmousemove="handleSwipeMove(event, this)"
             onmouseup="handleSwipeEnd(event, this, '${order.orderNumber}')"
             onmouseleave="if(currentSwipeElement === this) handleSwipeEnd(event, this, '${order.orderNumber}')">
          <div class="recent-order-header">
            <span class="recent-order-number">${order.orderNumber}</span>
            <span class="recent-order-total">‚Ç±${order.total}</span>
          </div>
          <div class="recent-order-details">
            ${order.customer} ‚Ä¢ ${order.payment} ‚Ä¢ ${order.timestamp}
          </div>
          <button class="reorder-btn" onclick="reorderFromHistory('${order.orderNumber}'); event.stopPropagation();">üîÑ Reorder</button>
          <div class="swipe-indicator">‚Üê Swipe to delete</div>
        </div>
      `).join('');
    }

    // REORDER FROM HISTORY
    function reorderFromHistory(orderNumber) {
      const orders = JSON.parse(localStorage.getItem('recentOrders') || '[]');
      const order = orders.find(o => o.orderNumber === orderNumber);

      if (!order || !order.items) {
        alert('Cannot reorder: order details not found');
        playErrorSound();
        return;
      }

      // Add each item from the order to cart
      order.items.forEach(item => {
        const price = menuPrices[item.item];
        if (typeof price === 'undefined') {
          console.error('Missing price for:', item.item);
          return;
        }

        const existingItem = cart.find(cartItem => cartItem.item === item.item);

        if (existingItem) {
          existingItem.quantity += item.quantity;
        } else {
          cart.push({
            item: item.item,
            quantity: item.quantity,
            price: price
          });
        }
      });

      updateCart();
      playSuccessSound();

      // Visual feedback
      const addBtn = document.getElementById('addToCartBtn');
      addBtn.classList.add('pulse');
      setTimeout(() => addBtn.classList.remove('pulse'), 300);

      // Close drawer
      toggleDrawer();

      alert(`Reordered ${order.items.length} item(s) from ${orderNumber}`);
    }

    function saveOrderToHistory(orderData) {
      const orders = JSON.parse(localStorage.getItem('recentOrders') || '[]');

      orders.push({
        orderNumber: orderData.orderNumber,
        total: orderData.grandTotal,
        customer: orderData.customer,
        payment: orderData.payment,
        items: orderData.items || [], // Save items for reorder functionality
        timestamp: new Date().toLocaleString('en-PH', {
          month: 'short',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit',
          hour12: true
        })
      });
      
      if (orders.length > 50) {
        orders.shift();
      }
      
      localStorage.setItem('recentOrders', JSON.stringify(orders));
      loadRecentOrders();
    }

    window.addEventListener('DOMContentLoaded', loadRecentOrders);

    function addToCart() {
      const itemSelect = document.getElementById('item');
      const qtyInput = document.getElementById('qty');

      const itemName = itemSelect.value;
      const quantity = parseInt(qtyInput.value);

      if (!itemName) {
        alert('Please select an item');
        playErrorSound();
        // Shake animation on dropdown
        itemSelect.classList.add('shake');
        setTimeout(() => itemSelect.classList.remove('shake'), 500);
        return;
      }

      if (quantity < 1) {
        alert('Quantity must be at least 1');
        playErrorSound();
        qtyInput.classList.add('shake');
        setTimeout(() => qtyInput.classList.remove('shake'), 500);
        return;
      }

      // PRICE CHECK ADDED HERE to prevent NaN errors
      const price = menuPrices[itemName];
      if (typeof price === 'undefined') {
        alert('Error: Price not found for this item. Please contact admin.');
        console.error('Missing price for:', itemName);
        playErrorSound();
        return;
      }

      const existingItem = cart.find(item => item.item === itemName);

      if (existingItem) {
        existingItem.quantity += quantity;
      } else {
        cart.push({
          item: itemName,
          quantity: quantity,
          price: price
        });
      }

      // Audio and visual feedback
      playAddToCartSound();
      const addBtn = document.getElementById('addToCartBtn');
      addBtn.classList.add('pulse');
      setTimeout(() => addBtn.classList.remove('pulse'), 300);

      itemSelect.value = '';
      qtyInput.value = 1;

      // Reset quantity buttons
      document.querySelectorAll('.qty-quick-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelector('.qty-quick-btn').classList.add('active'); // Activate √ó1

      updateCart();
      calculateChange();
    }

    function updateQuantity(itemName, change) {
      const item = cart.find(i => i.item === itemName);
      if (item) {
        item.quantity += change;
        if (item.quantity <= 0) {
          removeFromCart(itemName);
        } else {
          updateCart();
        }
      }
      calculateChange();
    }

    function removeFromCart(itemName) {
      cart = cart.filter(item => item.item !== itemName);
      updateCart();
      calculateChange();
    }

    function updateCart() {
      const cartContainer = document.getElementById('cartItems');
      const cartCount = document.getElementById('cartCount');
      const totalElement = document.getElementById('totalAmount');
      const submitBtn = document.getElementById('submitBtn');
      const clearCartBtn = document.getElementById('clearCartBtn');

      if (cart.length === 0) {
        cartContainer.innerHTML = '<div class="cart-empty">Cart is empty. Add items.</div>';
        cartCount.textContent = '0';
        totalElement.textContent = '0';
        submitBtn.disabled = true;
        clearCartBtn.style.display = 'none';
        return;
      }

      // Show clear cart button when there are items
      clearCartBtn.style.display = 'block';
      
      const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      
      cartContainer.innerHTML = cart.map(item => `
        <div class="cart-item">
          <div class="cart-item-info">
            <div class="cart-item-name">${item.item}</div>
            <div class="cart-item-details">
              ‚Ç±${item.price} √ó ${item.quantity} = ‚Ç±${item.price * item.quantity}
            </div>
          </div>
          <div class="cart-item-actions">
            <button class="qty-btn" onclick="updateQuantity('${item.item}', -1)">‚àí</button>
            <span style="font-weight: 700; min-width: 25px; text-align: center;">${item.quantity}</span>
            <button class="qty-btn" onclick="updateQuantity('${item.item}', 1)">+</button>
            <button class="remove-btn" onclick="removeFromCart('${item.item}')">‚úï</button>
          </div>
        </div>
      `).join('');
      
      cartCount.textContent = totalItems;
      totalElement.textContent = total.toFixed(0);
      submitBtn.disabled = false;
    }

    function showConfirmation() {
      if (cart.length === 0) {
        alert('Cart is empty!');
        return;
      }
      
      const payment = document.getElementById('payment').value;
      const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      
      if (payment === 'Cash') {
        const tendered = parseFloat(document.getElementById('amountTendered').value) || 0;
        if (tendered < total) {
          alert('Amount tendered must be at least ‚Ç±' + total);
          return;
        }
      } else if (payment === 'GCash') {
        const refNumber = document.getElementById('referenceNumber').value.trim();
        if (!refNumber) {
          alert('Please enter GCash reference number');
          return;
        }
      }
      
      const modal = document.getElementById('confirmModal');
      const confirmItems = document.getElementById('confirmItems');
      const confirmTotal = document.getElementById('confirmTotal');
      const confirmPayment = document.getElementById('confirmPayment');
      const confirmPaymentDetails = document.getElementById('confirmPaymentDetails');
      const confirmCustomer = document.getElementById('confirmCustomer');
      const previewOrderNumber = document.getElementById('previewOrderNumber');
      
      previewOrderNumber.textContent = 'Pending...';
      
      confirmItems.innerHTML = cart.map(item => `
        <div class="confirm-item">
          <div>
            <div style="font-weight: 600;">${item.item}</div>
            <div style="font-size: 13px; color: #666;">‚Ç±${item.price} √ó ${item.quantity}</div>
          </div>
          <div style="font-weight: 700;">‚Ç±${item.price * item.quantity}</div>
        </div>
      `).join('');
      
      confirmTotal.textContent = total.toFixed(0);
      confirmPayment.textContent = payment;
      
      if (payment === 'Cash') {
        const tendered = parseFloat(document.getElementById('amountTendered').value);
        const change = tendered - total;
        confirmPaymentDetails.innerHTML = `Tendered: <strong>‚Ç±${tendered.toFixed(2)}</strong> ‚Ä¢ Change: <strong>‚Ç±${change.toFixed(2)}</strong>`;
      } else {
        const refNumber = document.getElementById('referenceNumber').value;
        confirmPaymentDetails.innerHTML = `Ref#: <strong>${refNumber}</strong>`;
      }
      
      confirmCustomer.textContent = document.getElementById('customer').value || 'Walk-in';
      
      modal.classList.add('active');
    }

    function closeConfirmation() {
      document.getElementById('confirmModal').classList.remove('active');
    }

    async function submitOrder() {
      const confirmBtn = document.getElementById('confirmBtn');
      const result = document.getElementById('result');
      const loading = document.getElementById('loading');
      
      confirmBtn.disabled = true;
      confirmBtn.textContent = 'Processing...';
      loading.style.display = 'block'; 
      
      const payment = document.getElementById('payment').value;
      const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      
      // ADDED grandTotal explicitly here
      const data = {
        items: cart.map(item => ({
          item: item.item,
          quantity: item.quantity
        })),
        grandTotal: total, // Ensures backend gets the calculated total
        payment: payment,
        customer: document.getElementById('customer').value || 'Walk-in'
      };
      
      if (payment === 'Cash') {
        const tendered = parseFloat(document.getElementById('amountTendered').value);
        data.amountTendered = tendered;
        
        // FIXED calculation logic to prevent null
        const changeVal = tendered - total;
        data.change = isNaN(changeVal) ? 0 : changeVal;
      } else {
        data.referenceNumber = document.getElementById('referenceNumber').value.trim();
      }
      
      try {
        const response = await fetch(WEBHOOK_URL, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(data)
        });
        
        if (!response.ok) throw new Error('Network error');
        
        const responseData = await response.json();
        
        closeConfirmation();

        // Save order with items from current cart (backend may not return items)
        saveOrderToHistory({
          ...responseData,
          items: cart.map(item => ({ item: item.item, quantity: item.quantity }))
        });

        result.className = 'result success success-pop';
        result.style.display = 'block';

        result.innerHTML = `
          ‚úÖ <strong>Order Confirmed!</strong><br>
          Order #${responseData.orderNumber}<br>
          Total: ‚Ç±${responseData.grandTotal}
        `;

        // Play success sound
        playSuccessSound();

        cart = [];
        updateCart();
        document.getElementById('customer').value = '';
        document.getElementById('payment').selectedIndex = 0;
        document.getElementById('amountTendered').value = '';
        document.getElementById('referenceNumber').value = '';
        document.getElementById('changeDisplay').classList.remove('active');
        togglePaymentFields();
        
        setTimeout(() => {
          result.style.display = 'none';
        }, 5000);
        
      } catch (error) {
        closeConfirmation();
        result.className = 'result error shake';
        result.style.display = 'block';
        result.innerHTML = `‚ùå <strong>Order Failed</strong><br>${error.message}`;
        playErrorSound();
      } finally {
        loading.style.display = 'none'; 
        confirmBtn.disabled = false;
        confirmBtn.textContent = 'Confirm Order';
      }
    }
  </script>
</body>
</html>
